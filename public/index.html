<!DOCTYPE html>
<html>
<title>Amis Line Ether Wallet DApp</title>
<script src="jquery-3.2.1.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="icon" href="images/small_icon.png">
<style>
body {font-family: "Lato", sans-serif}
.mySlides {display: none}
</style>
<body>

<!-- Navbar -->
<div class="w3-top">
  <div class="w3-bar w3-black w3-card">
    <a class="w3-bar-item w3-button w3-padding-large w3-hide-medium w3-hide-large w3-right" href="javascript:void(0)" onclick="myFunction()" title="Toggle Navigation Menu"><i class="fa fa-bars"></i></a>
    <a href="accountinfo.html" class="w3-bar-item w3-button w3-padding-large">WALLET</a>
    <a href="transfer.html" class="w3-bar-item w3-button w3-padding-large w3-hide-small">TRANSFER</a>
    <a href="invoice.html" class="w3-bar-item w3-button w3-padding-large w3-hide-small">MANAGE INVOICE</a>
    <a href="taxi.html" class="w3-bar-item w3-button w3-padding-large w3-hide-small">TAXI</a>
    <a href="#about" class="w3-bar-item w3-button w3-padding-large w3-hide-small">ISSUE</a>
  </div>
</div>

<!-- Navbar on small screens -->
<div id="navDemo" class="w3-bar-block w3-black w3-hide w3-hide-large w3-hide-medium w3-top" style="margin-top:46px">
  <a href="accountinfo.html" class="w3-bar-item w3-button w3-padding-large">WALLET</a>
  <a href="transfer.html" class="w3-bar-item w3-button w3-padding-large">TRANSFER</a>
  <a href="invoice.html" class="w3-bar-item w3-button w3-padding-large">MANAGE INVOICE</a>
  <a href="taxi.html" class="w3-bar-item w3-button w3-padding-large">TAXI</a>
  <a href="#about" class="w3-bar-item w3-button w3-padding-large">ISSUE</a>
</div>

<!-- Page content -->
<div class="w3-content" style="max-width:2000px;margin-top:46px">

  <!-- The Demo Section -->
  <div class="w3-grey">
    <div class="w3-container w3-content w3-padding-64" style="max-width:800px">
      <h1 class="w3-center w3-text-black">Amis Line Ether Wallet DApp</h1>
      <p class="w3-opacity w3-center"><i>A mobile friendly Dapp for shopping with the AMIS ERC20 Token</i></p><br>

      
        <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px">
         
            <img src="amis.png" width="50px">
          </div>
        </div>
    </div>
  </div>
  <!--AccountInformation-->
  <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="video">
    <h2 class="">ACCOUNT INFORMATION </h2>
    <p class="w3-opacity"><a href="accountinfo.html" onFocus="if(this.blur)this.blur()">Check balance and Account Information</a></p>
    </div>

  <!--Video-->
  <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="video">
    <h2 class="">TRANSFER ETH </h2>
    <p class="w3-opacity"><a href="transfer.html" onFocus="if(this.blur)this.blur()">Transfer ETH and/or AMIS</a></p>
    </div>

  <!--Report-->
  <div class="w3-grey" id="report">
    <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px">
      <h2 class="w3-center">MANAGE INVOICE / BILL / REMITTANCE</h2>
      <p class="w3-opacity"><a href="invoice.html" onFocus="if(this.blur)this.blur()">Manage Invoice / Bills / Remittance</a></p>
    </div>
  </div>
    
  <!--Taxi-->
  <div class="w3-grey" id="taxi">
    <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px">
      <h2 class="w3-center">Taxi (Under Development) </h2>
      <p class="w3-opacity"><a href="taxi.html" onFocus="if(this.blur)this.blur()">Try it out !Take a ride</a></p>
    </div>
  </div>

  <!--About-->
    <div class="w3-container w3-content w3-center w3-padding-64" style="max-width:800px" id="about">
    <h2 class="">Issue</h2>
      <p class="w3-center">Report any issue(s) on our github page: <a href="https://github.com/Ami-Solution/etherbot" onFocus="if(this.blur)this.blur()">HERE</a></p>
  </div>
</div>

<!-- Footer -->
<footer class="w3-container w3-padding-32 w3-center w3-opacity w3-light-grey w3-xlarge">
  <p class="w3-medium">Powered by <a href="https://glitch.com" target="_blank">https://impartial-ellipse.glitch.me/</a></p>
</footer>

<script>
    var contractAddress = "0x695812015959805765a768bfc81dec406f1ae625"; // in Rinkeby testnet!
    var contractAbi = [{
        "constant": false,
        "inputs": [{
            "name": "_name",
            "type": "string"
        }, {
            "name": "_carType",
            "type": "bool"
        }],
        "name": "addUser",
        "outputs": [],
        "payable": true,
        "stateMutability": "payable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{
            "name": "distance",
            "type": "uint256"
        }, {
            "name": "additionalCost",
            "type": "uint256"
        }, {
            "name": "addressLender",
            "type": "address"
        }],
        "name": "carRequest",
        "outputs": [{
            "name": "",
            "type": "int256"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{
            "name": "",
            "type": "uint256"
        }],
        "name": "userA",
        "outputs": [{
            "name": "",
            "type": "address"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{
            "name": "distance",
            "type": "uint256"
        }, {
            "name": "additionalCost",
            "type": "uint256"
        }, {
            "name": "addressLender",
            "type": "address"
        }],
        "name": "arrive",
        "outputs": [{
            "name": "",
            "type": "uint256"
        }],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "getBankBalance",
        "outputs": [{
            "name": "_balance",
            "type": "uint256"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{
            "name": "distance",
            "type": "uint256"
        }, {
            "name": "additionalCost",
            "type": "uint256"
        }],
        "name": "getCost",
        "outputs": [{
            "name": "",
            "type": "uint256"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "getUserBalance",
        "outputs": [{
            "name": "_balance",
            "type": "uint256"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [{
            "name": "carCondition",
            "type": "uint8"
        }, {
            "name": "addressLender",
            "type": "address"
        }, {
            "name": "addressPreuser",
            "type": "address"
        }],
        "name": "rate",
        "outputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "getDiscount",
        "outputs": [{
            "name": "",
            "type": "uint256"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [{
            "name": "addr",
            "type": "address"
        }],
        "name": "getUserName",
        "outputs": [{
            "name": "_name",
            "type": "string"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "getUserSus",
        "outputs": [{
            "name": "_sus",
            "type": "int16"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "constant": false,
        "inputs": [],
        "name": "numUser",
        "outputs": [{
            "name": "",
            "type": "uint256"
        }],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "function"
    }, {
        "constant": true,
        "inputs": [],
        "name": "getUserRep",
        "outputs": [{
            "name": "_reputation",
            "type": "int16"
        }],
        "payable": false,
        "stateMutability": "view",
        "type": "function"
    }, {
        "inputs": [],
        "payable": false,
        "stateMutability": "nonpayable",
        "type": "constructor"
    }];

    // Checking if Web3 has been injected by the browser (Mist/MetaMask)
    if (typeof web3 !== 'undefined') {
        // Use Mist/MetaMask's provider
        $('#view').text('web3 is installed');
        window.web3 = new Web3(web3.currentProvider);
    } else {
        var errorMsg = 'web3 is missing :( Please open in Google Chrome Browser and install the Metamask extension.';
        $('#view').text(errorMsg);
        console.log(errorMsg);
    }

    $(window).on('load', function() {
        // create instance of contract object that we use to interface the smart contract
        var contractInstance = web3.eth.contract(contractAbi).at(contractAddress);
        var carArray = [1,1,0];
        var distanceArray = [5,6,24];
        var additionalCost = 5;
        var addressLender = "0xE36f336068c4b0288443726CdBF3D1F29b21d272"
        var addressPre = "0x495c89cF8085130cd6861B02E8B74C02f61166Ec"
        contractInstance.getBankBalance(function(error, balance) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#view').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#view').text("Bank Balance: " + balance/1e+18);
        });
        
        $('.addUserButton').on('click', function() {
            var car = carArray[document.getElementById("carType").selectedIndex];
            var user = $('#inputName').val();
            addUser(contractInstance, user, car)
        });

        $('.requestCoinButton').on('click', function() {
            requestCoin(contractInstance)
        });
        
        $('.showUserButton').on('click', function() {
            showUser(contractInstance)
        });
        
        $('.requestCarButton').on('click', function() {
            var distance = distanceArray[document.getElementById("selectedEndPoint").selectedIndex];
            requestCar(contractInstance, distance, additionalCost, addressLender)
        });
        
        $('.driveButton').on('click', function() {
            var distance = distanceArray[document.getElementById("selectedEndPoint").selectedIndex];
            drive(contractInstance, distance, additionalCost, addressLender);
        });
        
        $('.rateButton').on('click', function() {
            var rating = document.getElementById("rating").selectedIndex;
            rateUser(contractInstance, rating, addressLender, addressPre);
        });
    });
    
    function addUser(contractInstance, user, car) {
        contractInstance.addUser(user, car, function(error) {
            if (error) {
                var errorMsg = 'error reading greeting from smart contract: ' + error;
                $('#view').text(errorMsg);
                console.log(errorMsg);
                return;
            }
            $('#view').text("Successful creation of User with " + user + ", " + car);
        });
    }
    
    function showUser(contractInstance) {
        contractInstance.getUserBalance(function(error, balance) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#requestedUserBalance').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#requestedUserBalance').text("User Balance: " + balance/1e+18);
        });
        contractInstance.getUserRep(function(error, rep) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#requestedUserRep').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#requestedUserRep').text("User RepToken: " + rep);
        });
        contractInstance.getUserSus(function(error, sus) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#requestedUserSus').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#requestedUserSus').text("User SusToken: " + sus);
        });
    }
    
    function requestCar(contractInstance, dist, addCost, addressLender) {
        contractInstance.carRequest(dist, addCost, addressLender, function(error, expectedCost) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#view').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#view').text("Expected Cost: " + expectedCost/1e+18);
        });
    }
    
    function drive(contractInstance, dist, addCost, addressLender) {
        contractInstance.arrive(dist, addCost, addressLender, function(error, effCost) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#view').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#view').text("Transaction at: " + effCost);
        });
    }
    
    function rateUser(contractInstance, carCond, addressLender, addressPre) {
        contractInstance.rate((carCond+1), addressLender, addressPre, function(error) {
            if (error) {
                    var errorMsg = 'error reading greeting from smart contract: ' + error;
                    $('#view').text(errorMsg);
                    console.log(errorMsg);
                    return;
                }
                $('#view').text(carCond + "," + addressLender+"," + addressPre);
        });
    }

</script>
</body>
</html>